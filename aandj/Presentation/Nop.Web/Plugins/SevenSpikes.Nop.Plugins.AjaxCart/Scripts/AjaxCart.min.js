/*
* Copyright 2015 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

$(document).ready(function () { (function (e, b, q) { function l() { var a = C(), c = a.buttonsParameters; if (0 < c.length) { var d = b.getAttrValFromDom(m, "data-getAjaxCartButtonUrl"); b.ajax({ cache: !1, type: "POST", data: b.toJSON(c), contentType: "application/json; charset=utf-8", url: d, success: function (c) { if ("" != c) { for (var f = 0; f < a.addToCartButtons.length; f++) { var d = a.addToCartButtons[f], n = b(c).filter("div[data-productId='" + d.productId + "']"); if (n && 0 < n.length) { var e = b.getAttrValFromDom(n, "data-isProductPage"); e && e == d.isProductPage.toString() && (b(d.buttonElement).parents(".product-item, .add-to-cart").addClass("sevenspikes-ajaxcart"), b(d.buttonElement).replaceWith(n[0])) } } b.event.trigger({ type: "nopAjaxCartButtonsAddedEvent" }) } }, error: function (b, a, c) { } }) } } function D(a) { if (!e.waitForAjaxRequest) { e.waitForAjaxRequest = !0; var c = b.getHiddenValFromDom("#checkProductAttributesUrl"), d = b.getAttrValFromDom(a.currentTarget, "data-productId"), g = r(a.currentTarget), d = { productId: d, quantity: g }; t(); b.ajax({ cache: !1, type: "POST", dataType: "json", data: b.toJSON(d), contentType: "application/json; charset=utf-8", url: c, success: function (b) { u(b, a, !1) }, error: function (b, c, d) { u(data, a, !0) } }) } } function u(a, c, d) { var g = b.getHiddenValFromDom("#addProductToCartUrl"), f = b.getAttrValFromDom(c.currentTarget, "data-productId"), h = r(c.currentTarget); c = { productId: f, quantity: h }; d ? (k(), e.waitForAjaxRequest = !1) : a.HasProductAttributes ? (E(f, h), k(), e.waitForAjaxRequest = !1) : b.ajax({ cache: !1, type: "POST", dataType: "json", data: b.toJSON(c), contentType: "application/json; charset=utf-8", url: g, success: function (a) { k(); e.waitForAjaxRequest = !1; "success" == a.Status ? (v(), w(), x(), y(h), z(a.ProductAddedToCartWindow), b.event.trigger({ type: "nopAjaxCartProductAddedToCartEvent" })) : "warning" == a.Status ? A(a.AddToCartWarnings) : "error" == a.Status && A(a.ErrorMessage) }, error: function (b, a, c) { k(); e.waitForAjaxRequest = !1 } }) } function F(a, c) { c == q && (c = !1); if (!e.waitForAjaxRequest) { e.waitForAjaxRequest = !0; var d = b(a.currentTarget), g = b.getHiddenValFromDom("#addProductVariantToCartUrl"), f = b.getAttrValFromDom(a.currentTarget, "data-productId"), h = G(d), d = b(d).closest("form").serialize(); 0 == d.length && (formSelector = b("body").find("form"), d = b(formSelector).serialize()); 0 != d.length && (d += "&"); d += "productId=" + f; c ? H() : t(); b.ajax({ cache: !1, type: "POST", data: d, url: g, success: function (d) { if ("warning" == d.Status || "error" == d.Status) { p(c); e.waitForAjaxRequest = !1; var f = b(a.currentTarget).closest(".overview"), g = d.AddToCartWarnings; d = d.PopupTitle; c ? 0 < f.length ? f.find(".message-error").html(g) : b(".miniProductDetailsView .message-error").html(g) : (f = b(".addProductVariantToCartErrors").data("kendoWindow"), f || (f = b(".addProductVariantToCartErrors").kendoWindow({ draggable: !1, resizable: !1, width: "300px", modal: !0, actions: ["Close"], animation: !1, visible: !1, title: d }).data("kendoWindow"), f.wrapper.addClass("ajaxCart")), f.content(g), f.center(), f.open()) } else v(), x(), y(h), w(), c && b(".miniProductDetailsView").data("kendoWindow").close(), p(c), e.waitForAjaxRequest = !1, z(d.ProductAddedToCartWindow), b.event.trigger({ type: "nopAjaxCartProductAddedToCartEvent" }) }, error: function (b, a, d) { p(c); e.waitForAjaxRequest = !1 } }) } } function C() { var a = b.getAttrValFromDom(m, "data-productPageAddToCartButtonSelector"), c = b.getAttrValFromDom(m, "data-productBoxAddToCartButtonSelector"), d = [], e = []; b(a).each(function () { if (!b(this).is(".nopAjaxCartProductVariantAddToCartButton")) { var a = b.getAttrValFromDom(this, "data-productid", 0); if (a && 0 < a) { var c = { productId: a, isProductPage: !0, buttonElement: b(this) }, a = { productId: a, isProductPage: !0, buttonValue: B(b(this)) }; d.push(c); e.push(a) } } }); b(c).each(function () { if (!b(this).is(".nopAjaxCartProductListAddToCartButton")) { var a; var c = b(this); a = b.getAttrValFromDom(m, "data-productBoxProductItemElementSelector"); a = a == q || "" == a ? 0 : b.getAttrValFromDom(b(c).parents(a), "data-productid", 0); a && 0 < a && (c = { productId: a, isProductPage: !1, buttonElement: b(this) }, a = { productId: a, isProductPage: !1, buttonValue: B(b(this)) }, d.push(c), e.push(a)) } }); return { addToCartButtons: d, buttonsParameters: e } } function B(a) { return b.getAttrValFromDom(a, "value") } function p(a) { a ? b(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").hide() : k() } function H() { if (0 < b(".miniProductDetailsView").length) { var a = b(".miniProductDetailsView").parent().height(), c = b(".miniProductDetailsView").parent().width(); b(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").height(a - 10); b(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").width(c - 10); b(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").show() } } function G(a) { var c = 1; a = b.getAttrValFromDom(a, "data-productId"); "" != a && (a = "#addtocart_" + a + "_EnteredQuantity", 0 < b(a).length && (a = b(a).val(), 0 < a && (c = a))); return c } function A(a) { var c = b(".addProductToCartErrors").data("kendoWindow"); c || (c = b(".addProductToCartErrors").kendoWindow({ draggable: !1, resizable: !1, width: "300px", height: "100px", modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow"), c.wrapper.addClass("ajaxCart")); c.content(a); c.center(); c.open() } function z(a) { b(".productAddedToCartWindow").html(b(a).html()); a = b(".productAddedToCartWindow").data("kendoWindow"); a.center(); a.open() } function y(a) { var c = '.header-links a[href="/cart"]', d = b.getHiddenValFromDom("#shoppingCartMenuLinkSelector"); 0 < b("#shoppingCartMenuLinkSelector").length && "" != d && (c = d, c = b("<div/>").html(c).text()); c = b(c).filter(":last"); 0 < c.length && (d = c.html(), d = /\d+/.exec(d), a = parseInt(d) + parseInt(a), a = b(".ajaxCartInfo").attr("data-miniShoppingCartQuatityFormattingResource").replace("{0}", a), c.html(a)) } function x() { var a = b.getHiddenValFromDom("#shoppingCartBoxUrl"), c = b.getHiddenValFromDom("#shoppingCartBoxPanelSelector"); 0 < b(c).length && b.ajax({ cache: !1, type: "GET", url: a, success: function (a) { a = b(a).filter(c); b(c).replaceWith(a) }, error: function (b, a, c) { } }) } function w() { var a = b.getHiddenValFromDom("#flyoutShoppingCartUrl"), c = b.getHiddenValFromDom("#flyoutShoppingCartPanelSelector"); 0 < b(c).length && b.ajax({ cache: !1, type: "GET", url: a, success: function (a) { a = b(a).filter(c); b(c).replaceWith(a) }, error: function (b, a, c) { } }) } function v() { var a = b.getHiddenValFromDom("#miniShoppingCartUrl"); 0 < b(".block.block-shoppingcart").length && b.ajax({ cache: !1, type: "GET", url: a, success: function (a) { a = b(a).filter(".block.block-shoppingcart"); b(".block.block-shoppingcart").replaceWith(a) }, error: function (a, b, e) { } }) } function E(a, c) { var d = { productId: a }, e = b.getHiddenValFromDom("#getMiniProductDetailsViewUrl"); b.ajax({ cache: !1, async: !1, type: "POST", data: b.toJSON(d), contentType: "application/json; charset=utf-8", url: e, success: function (a) { a = '<div class="miniProductDetailsPanelAjaxBusy"></div><div class="clear"></div>' + a; a = b(".miniProductDetailsView").data("kendoWindow").content(a); a.center(); a.open(); a = b.getAttrValFromDom(".miniProductDetailsView .miniProductDetailsViewAddToCartButton", "data-productId", 0); 0 < a && (a = ".miniProductDetailsView #addtocart_" + a + "_EnteredQuantity", 0 < b(a).length && b(a).val(c)) }, error: function (a, b, c) { } }) } function r(a) { var c = 1; a = b.getAttrValFromDom(a, "data-productId"); "" != a && (a = "#productQuantity" + a, 0 < b(a).length && (a = b(a).val(), 0 < a && (c = a))); return c } function t() { var a = b("body"); if (0 < a.length) { var c = a.height(), a = a.width(); b(".nopAjaxCartPanelAjaxBusy").height(c); b(".nopAjaxCartPanelAjaxBusy").width(a); b(".nopAjaxCartPanelAjaxBusy").show() } } function k() { b(".nopAjaxCartPanelAjaxBusy").hide() } e.waitForAjaxRequest = !1; e.replaceAddToCartButtonsExternal = function () { l() }; var m = ".ajaxCartInfo"; e.closeProductAddedToCartWindow = function () { var a = b(".productAddedToCartWindow").data("kendoWindow"); a && a.close() }; l(); (function () { var a = b("body"); 0 == a.find(".nopAjaxCartPanelAjaxBusy").length && (a.prepend('<div class="nopAjaxCartPanelAjaxBusy"></div>'), b(".nopAjaxCartPanelAjaxBusy").hide()) })(); (function () { var a = b("body"); 0 < a.length && (a.prepend('<div class="productAddedToCartWindow"></div>'), a.prepend('<div class="miniProductDetailsView"></div>'), a.prepend('<div class="addProductVariantToCartErrors"></div>'), a.prepend('<div class="addProductToCartErrors"></div>'), b(".miniProductDetailsView").kendoWindow({ draggable: !1, resizable: !1, modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow").wrapper.addClass("ajaxCart")); b(".productAddedToCartWindow").kendoWindow({ draggable: !1, resizable: !1, modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow").wrapper.addClass("ajaxCart") })(); b("body").on("click", ".nopAjaxCartProductListAddToCartButton", function (a) { D(a) }); b("body").on("click", ".nopAjaxCartProductVariantAddToCartButton", function (a) { var c = !1; b(this).hasClass("miniProductDetailsViewAddToCartButton") && (c = !0); F(a, c) }); b(document).on("nopAjaxFiltersFiltrationCompleteEvent", l); b(document).on("nopQuickViewDataShownEvent", l) })(window.nopAjaxCart = window.nopAjaxCart || {}, jQuery) }); function ajaxCartAllowedQuantitiesHover(e) { $(".productQuantityDropdown").off("mousedown").on("mousedown", function () { var b = $(this).parents(e); b.addClass("ajax-cart-product-item-hover"); b = b.attr("data-productid"); $(".productQuantityChanged" + b).val("yes") }); $(e).off("mouseenter").on("mouseenter", function () { var b = $(this).attr("data-productid"), b = $(".productQuantityChanged" + b); "yes" == b.val() && b.val("no") }).off("mouseleave").on("mouseleave", function () { var b = $(this).attr("data-productid"); "no" == $(".productQuantityChanged" + b).val() && $(this).removeClass("ajax-cart-product-item-hover") }) };
